% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/subtyper.R
\name{assess_idp_consistency}
\alias{assess_idp_consistency}
\title{Assess neuroscientific consistency between IDPs and performance domains (Optimized)}
\usage{
assess_idp_consistency(
  df,
  Perf.Dom,
  idp_cols,
  prompt = generate_idp_interpretation_prompt(),
  backend = c("groq", "openrouter"),
  api_key_env = NULL,
  model = NULL,
  max_retries = 5,
  retry_delay_base = 2,
  temperature = 0.1,
  user_input_prompt =
    "Assess the neuroscientific consistency and provide JSON with consistency, justification, and plausibility.",
  verbose = TRUE,
  parallel = FALSE,
  .options_furrr = furrr::furrr_options()
)
}
\arguments{
\item{df}{A data frame containing at least the performance domain column and one or more IDP columns.}

\item{Perf.Dom}{Character string, name of the column in \code{df} containing the performance domain.}

\item{idp_cols}{Character vector of column names containing IDPs.}

\item{prompt}{Default LLM prompt, see \code{generate_idp_interpretation_prompt}.}

\item{backend}{API backend: \code{"groq"} or \code{"openrouter"}.}

\item{api_key_env}{Env var storing the API key. Defaults to "GROQ_API_KEY" or "OPENROUTER_API_KEY".}

\item{model}{Model name. Defaults: \code{"llama3-70b-8192"} (Groq) or \code{"openai/gpt-4o-mini"} (OpenRouter).}

\item{max_retries}{Integer, maximum number of retries in case of rate limiting.}

\item{retry_delay_base}{Numeric, base delay in seconds for exponential backoff.}

\item{temperature}{Numeric, sampling temperature (0–1).}

\item{user_input_prompt}{Extra text appended to user prompt.}

\item{verbose}{Logical, print debug info.}

\item{parallel}{Logical, if \code{TRUE} use \code{furrr::future_map} for parallel calls.}

\item{.options_furrr}{List, options passed to \code{furrr::future_map}.}
}
\value{
A data frame with the original data plus:
\itemize{
\item \code{consistency} - low/medium/high label.
\item \code{justification} - model’s neuroscientific justification.
\item \code{plausibility} - numeric \link{0–1} plausibility score.
}
}
\description{
This function queries a large language model via either the Groq API or OpenRouter API
to assess the neuroscientific support for the relationship between imaging-derived
phenotypes (IDPs) and a cognitive performance domain. It aggregates multiple IDPs per row
and provides an overall confidence rating, justification, and plausibility score.
}
\details{
Reproducibility note: Because hosted LLMs can change over time, responses may vary across runs
even with identical inputs. See source code for caching and reproducibility considerations.
}
